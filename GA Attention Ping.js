(function(){function a(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function b(a,b){var c=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];this.obs=a,this.sync=b,this.lazy=c,this.queue=[]}function c(){b.apply(this,arguments)}function d(a){b.call(this,a,!0)}function e(a,b,c){this.context=a,this.method=b,this.args=c}function f(a){this.value=a}function g(){this.id=++ba}function h(a,b){return this instanceof h?(g.call(this),void(!b&&K.isFunction(a)||(null!=a?a._isNext:void 0)?(this.valueF=a,this.valueInternal=void 0):(this.valueF=void 0,this.valueInternal=a))):new h(a,b)}function i(a,b){return this instanceof i?void h.call(this,a,b):new i(a,b)}function j(){return this instanceof j?void g.call(this):new j}function k(a){return this instanceof k?(this.error=a,void g.call(this)):new k(a)}function l(a){this.desc=a,this.id=++ga,this.initialDesc=this.desc}function m(){var a=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];this.unsubscribe=K.bind(this.unsubscribe,this),this.unsubscribed=!1,this.subscriptions=[],this.starting=[];for(var b,c=0;c<a.length;c++)b=a[c],this.add(b)}function n(a,b){this._subscribe=a,this._handleEvent=b,this.subscribe=K.bind(this.subscribe,this),this.handleEvent=K.bind(this.handleEvent,this),this.pushing=!1,this.ended=!1,this.prevError=void 0,this.unsubSrc=void 0,this.subscriptions=[],this.queue=[]}function o(a,b,c){return this instanceof o?(K.isFunction(a)&&(c=b,b=a,a=e.empty),l.call(this,a),D(b),this.dispatcher=new n(b,c),void ha(this)):new o(a,b,c)}function p(a,b,c){n.call(this,b,c),this.property=a,this.subscribe=K.bind(this.subscribe,this),this.current=_,this.currentValueRootId=void 0,this.propertyEnded=!1}function q(a,b,c){l.call(this,a),D(b),this.dispatcher=new p(this,b,c),ha(this)}function r(){return this instanceof r?(this.unsubAll=K.bind(this.unsubAll,this),this.subscribeAll=K.bind(this.subscribeAll,this),this.guardedSink=K.bind(this.guardedSink,this),this.sink=void 0,this.subscriptions=[],this.ended=!1,void o.call(this,new u.Desc(u,"Bus",[]),this.subscribeAll)):new r}function s(a){return[a,ea()]}var t=Array.prototype.slice,u={toString:function(){return"Bacon"}};u.version="0.7.82";var v=("undefined"!=typeof global&&null!==global?global:this).Error,w=function(){},x=function(a,b){return a},y=function(a){return a.slice(0)},z=function(a,b){if(!b)throw new v(a)},A=function(a){if((null!=a?a._isObservable:void 0)&&!(null!=a?a._isProperty:void 0))throw new v("Observable is not a Property : "+a)},B=function(a){if(!(null!=a?a._isEventStream:void 0))throw new v("not an EventStream : "+a)},C=function(a){if(!(null!=a?a._isObservable:void 0))throw new v("not an Observable : "+a)},D=function(a){return z("not a function : "+a,K.isFunction(a))},E=function(a){return a instanceof Array},F=function(a){return a&&a._isObservable},G=function(a){if(!E(a))throw new v("not an array : "+a)},H=function(a){return z("no arguments supported",0===a.length)},I=function(a){for(var b=arguments.length,c=1;b>1?b>c:c>b;b>1?c++:c--)for(var d in arguments[c])a[d]=arguments[c][d];return a},J=function(a,b){var c={}.hasOwnProperty,d=function(){};d.prototype=b.prototype,a.prototype=new d;for(var e in b)c.call(b,e)&&(a[e]=b[e]);return a},K={indexOf:function(){return Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c,d=0;d<a.length;d++)if(c=a[d],b===c)return d;return-1}}(),indexWhere:function(a,b){for(var c,d=0;d<a.length;d++)if(c=a[d],b(c))return d;return-1},head:function(a){return a[0]},always:function(a){return function(){return a}},negate:function(a){return function(b){return!a(b)}},empty:function(a){return 0===a.length},tail:function(a){return a.slice(1,a.length)},filter:function(a,b){for(var c,d=[],e=0;e<b.length;e++)c=b[e],a(c)&&d.push(c);return d},map:function(a,b){return function(){for(var c,d=[],e=0;e<b.length;e++)c=b[e],d.push(a(c));return d}()},each:function(a,b){for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=a[c];b(c,d)}},toArray:function(a){return E(a)?a:[a]},contains:function(a,b){return-1!==K.indexOf(a,b)},id:function(a){return a},last:function(a){return a[a.length-1]},all:function(a){for(var b,c=arguments.length<=1||void 0===arguments[1]?K.id:arguments[1],d=0;d<a.length;d++)if(b=a[d],!c(b))return!1;return!0},any:function(a){for(var b,c=arguments.length<=1||void 0===arguments[1]?K.id:arguments[1],d=0;d<a.length;d++)if(b=a[d],c(b))return!0;return!1},without:function(a,b){return K.filter(function(b){return b!==a},b)},remove:function(a,b){var c=K.indexOf(b,a);return c>=0?b.splice(c,1):void 0},fold:function(a,b,c){for(var d,e=0;e<a.length;e++)d=a[e],b=c(b,d);return b},flatMap:function(a,b){return K.fold(b,[],function(b,c){return b.concat(a(c))})},cached:function(a){var b=_;return function(){return("undefined"!=typeof b&&null!==b?b._isNone:void 0)&&(b=a(),a=void 0),b}},bind:function(a,b){return function(){return a.apply(b,arguments)}},isFunction:function(a){return"function"==typeof a},toString:function(a){var b,c,d,e={}.hasOwnProperty;try{return L++,null==a?"undefined":K.isFunction(a)?"function":E(a)?L>5?"[..]":"["+K.map(K.toString,a).toString()+"]":null!=(null!=a?a.toString:void 0)&&a.toString!==Object.prototype.toString?a.toString():"object"==typeof a?L>5?"{..}":(b=function(){var b=[];for(c in a)e.call(a,c)&&(d=function(){var b;try{return a[c]}catch(b){return b}}(),b.push(K.toString(c)+":"+K.toString(d)));return b}(),"{"+b+"}"):a}finally{L--}}},L=0;u._=K;var M=u.UpdateBarrier=function(){var a,b=[],c={},d=[],e=0,f={},g=function(b){return a?d.push(b):b()},h=function(d,e){if(a){var f=c[d.id];return"undefined"==typeof f||null===f?(f=c[d.id]=[e],b.push(d)):f.push(e)}return e()},i=function(){for(;b.length>0;)j(0,!0);f={}},j=function(a,d){var e=b[a],f=e.id,g=c[f];b.splice(a,1),delete c[f],d&&b.length>0&&k(e);for(var h,i=0;i<g.length;i++)(h=g[i])()},k=function(a){if(!f[a.id]){for(var d,e=a.internalDeps(),g=0;g<e.length;g++)if(d=e[g],k(d),c[d.id]){var h=K.indexOf(b,d);j(h,!1)}f[a.id]=!0}},l=function(b,c,f,g){if(a)return f.apply(c,g);a=b;try{var h=f.apply(c,g);i()}finally{for(a=void 0;e<d.length;){var j=d[e];e++,j()}e=0,d=[]}return h},m=function(){return a?a.id:void 0},n=function(a,b){var c=!1,d=!1,e=function(){return d=!0},f=function(){return c=!0,e()};return e=a.dispatcher.subscribe(function(a){return g(function(){if(!c){var d=b(a);if(d===u.noMore)return f()}})}),d&&e(),f},o=function(){return b.length>0};return{whenDoneWith:h,hasWaiters:o,inTransaction:l,currentEventId:m,wrappedSubscribe:n,afterTransaction:g}}();I(b.prototype,{_isSource:!0,subscribe:function(a){return this.obs.dispatcher.subscribe(a)},toString:function(){return this.obs.toString()},markEnded:function(){return this.ended=!0,!0},consume:function(){return this.lazy?{value:K.always(this.queue[0])}:this.queue[0]},push:function(a){return this.queue=[a],[a]},mayHave:function(){return!0},hasAtLeast:function(){return this.queue.length},flatten:!0}),J(c,b),I(c.prototype,{consume:function(){return this.queue.shift()},push:function(a){return this.queue.push(a)},mayHave:function(a){return!this.ended||this.queue.length>=a},hasAtLeast:function(a){return this.queue.length>=a},flatten:!1}),J(d,b),I(d.prototype,{consume:function(){var a=this.queue;return this.queue=[],{value:function(){return a}}},push:function(a){return this.queue.push(a.value())},hasAtLeast:function(){return!0}}),b.isTrigger=function(a){return(null!=a?a._isSource:void 0)?a.sync:null!=a?a._isEventStream:void 0},b.fromObservable=function(a){return(null!=a?a._isSource:void 0)?a:(null!=a?a._isProperty:void 0)?new b(a,!1):new c(a,!0)},I(e.prototype,{_isDesc:!0,deps:function(){return this.cached||(this.cached=P([this.context].concat(this.args))),this.cached},toString:function(){return K.toString(this.context)+"."+K.toString(this.method)+"("+K.map(K.toString,this.args)+")"}});var N=function(a,b){var c=a||b;if(c&&c._isDesc)return a||b;for(var d=arguments.length,f=Array(d>2?d-2:0),g=2;d>g;g++)f[g-2]=arguments[g];return new e(a,b,f)},O=function(a,b){return b.desc=a,b},P=function(a){return E(a)?K.flatMap(P,a):F(a)?[a]:("undefined"!=typeof a&&null!==a?a._isSource:void 0)?[a.obs]:[]};u.Desc=e,u.Desc.empty=new u.Desc("","",[]);var Q=function(b){return function(c){for(var d=arguments.length,e=Array(d>1?d-1:0),f=1;d>f;f++)e[f-1]=arguments[f];if("object"==typeof c&&e.length){var g=c,h=e[0];c=function(){return g[h].apply(g,arguments)},e=e.slice(1)}return b.apply(void 0,[c].concat(a(e)))}},R=function(b){return b=Array.prototype.slice.call(b),W.apply(void 0,a(b))},S=function(b,c){return function(){for(var d=arguments.length,e=Array(d),f=0;d>f;f++)e[f]=arguments[f];return b.apply(void 0,a(c.concat(e)))}},T=function(a){return function(b){return function(c){if("undefined"!=typeof c&&null!==c){var d=c[b];return K.isFunction(d)?d.apply(c,a):d}}}},U=function(a,b){var c=a.slice(1).split("."),d=K.map(T(b),c);return function(a){for(var b,c=0;c<d.length;c++)b=d[c],a=b(a);return a}},V=function(a){return"string"==typeof a&&a.length>1&&"."===a.charAt(0)},W=Q(function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return K.isFunction(a)?c.length?S(a,c):a:V(a)?U(a,c):K.always(a)}),X=function(b,c){return W.apply(void 0,[b].concat(a(c)))},Y=function(a,b,c,d){if("undefined"!=typeof b&&null!==b?b._isProperty:void 0){var e=b.sampledBy(a,function(a,b){return[a,b]});return d.call(e,function(a){var b=a[0];a[1];return b}).map(function(a){var b=(a[0],a[1]);return b})}return b=X(b,c),d.call(a,b)},Z=function(a){if(K.isFunction(a))return a;if(V(a)){var b=$(a);return function(a,c){return a[b](c)}}throw new v("not a function or a field key: "+a)},$=function(a){return a.slice(1)};I(f.prototype,{_isSome:!0,getOrElse:function(){return this.value},get:function(){return this.value},filter:function(a){return a(this.value)?new f(this.value):_},map:function(a){return new f(a(this.value))},forEach:function(a){return a(this.value)},isDefined:!0,toArray:function(){return[this.value]},inspect:function(){return"Some("+this.value+")"},toString:function(){return this.inspect()}});var _={_isNone:!0,getOrElse:function(a){return a},filter:function(){return _},map:function(){return _},forEach:function(){},isDefined:!1,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}},aa=function(a){return("undefined"!=typeof a&&null!==a?a._isSome:void 0)||("undefined"!=typeof a&&null!==a?a._isNone:void 0)?a:new f(a)};u.noMore="<no-more>",u.more="<more>";var ba=0;g.prototype._isEvent=!0,g.prototype.isEvent=function(){return!0},g.prototype.isEnd=function(){return!1},g.prototype.isInitial=function(){return!1},g.prototype.isNext=function(){return!1},g.prototype.isError=function(){return!1},g.prototype.hasValue=function(){return!1},g.prototype.filter=function(){return!0},g.prototype.inspect=function(){return this.toString()},g.prototype.log=function(){return this.toString()},J(h,g),h.prototype.isNext=function(){return!0},h.prototype.hasValue=function(){return!0},h.prototype.value=function(){var a;return(null!=(a=this.valueF)?a._isNext:void 0)?(this.valueInternal=this.valueF.value(),this.valueF=void 0):this.valueF&&(this.valueInternal=this.valueF(),this.valueF=void 0),this.valueInternal},h.prototype.fmap=function(a){var b,c;return this.valueInternal?(c=this.valueInternal,this.apply(function(){return a(c)})):(b=this,this.apply(function(){return a(b.value())}))},h.prototype.apply=function(a){return new h(a)},h.prototype.filter=function(a){return a(this.value())},h.prototype.toString=function(){return K.toString(this.value())},h.prototype.log=function(){return this.value()},h.prototype._isNext=!0,J(i,h),i.prototype._isInitial=!0,i.prototype.isInitial=function(){return!0},i.prototype.isNext=function(){return!1},i.prototype.apply=function(a){return new i(a)},i.prototype.toNext=function(){return new h(this)},J(j,g),j.prototype.isEnd=function(){return!0},j.prototype.fmap=function(){return this},j.prototype.apply=function(){return this},j.prototype.toString=function(){return"<end>"},J(k,g),k.prototype.isError=function(){return!0},k.prototype.fmap=function(){return this},k.prototype.apply=function(){return this},k.prototype.toString=function(){return"<error> "+K.toString(this.error)},u.Event=g,u.Initial=i,u.Next=h,u.End=j,u.Error=k;var ca=function(a){return new i(a,!0)},da=function(a){return new h(a,!0)},ea=function(){return new j},fa=function(a){return a&&a._isEvent?a:da(a)},ga=0,ha=function(){};I(l.prototype,{_isObservable:!0,subscribe:function(a){return M.wrappedSubscribe(this,a)},subscribeInternal:function(a){return this.dispatcher.subscribe(a)},onValue:function(){var a=R(arguments);return this.subscribe(function(b){return b.hasValue()?a(b.value()):void 0})},onValues:function(b){return this.onValue(function(c){return b.apply(void 0,a(c))})},onError:function(){var a=R(arguments);return this.subscribe(function(b){return b.isError()?a(b.error):void 0})},onEnd:function(){var a=R(arguments);return this.subscribe(function(b){return b.isEnd()?a():void 0})},name:function(a){return this._name=a,this},withDescription:function(){return this.desc=N.apply(void 0,arguments),this},toString:function(){return this._name?this._name:this.desc.toString()},internalDeps:function(){return this.initialDesc.deps()}}),l.prototype.assign=l.prototype.onValue,l.prototype.forEach=l.prototype.onValue,l.prototype.inspect=l.prototype.toString,u.Observable=l,I(m.prototype,{add:function(a){var b=this;if(!this.unsubscribed){var c=!1,d=w;this.starting.push(a);var e=function(){return b.unsubscribed?void 0:(c=!0,b.remove(d),K.remove(a,b.starting))};return d=a(this.unsubscribe,e),this.unsubscribed||c?d():this.subscriptions.push(d),K.remove(a,this.starting),d}},remove:function(a){return this.unsubscribed?void 0:void 0!==K.remove(a,this.subscriptions)?a():void 0},unsubscribe:function(){if(!this.unsubscribed){this.unsubscribed=!0;for(var a=this.subscriptions,b=0;b<a.length;b++)a[b]();return this.subscriptions=[],this.starting=[],[]}},count:function(){return this.unsubscribed?0:this.subscriptions.length+this.starting.length},empty:function(){return 0===this.count()}}),u.CompositeUnsubscribe=m,n.prototype.hasSubscribers=function(){return this.subscriptions.length>0},n.prototype.removeSub=function(a){return this.subscriptions=K.without(a,this.subscriptions),this.subscriptions},n.prototype.push=function(a){return a.isEnd()&&(this.ended=!0),M.inTransaction(a,this,this.pushIt,[a])},n.prototype.pushToSubscriptions=function(a){try{for(var b=this.subscriptions,c=b.length,d=0;c>d;d++){var e=b[d],f=e.sink(a);(f===u.noMore||a.isEnd())&&this.removeSub(e)}return!0}catch(g){throw this.pushing=!1,this.queue=[],g}},n.prototype.pushIt=function(a){if(this.pushing)return this.queue.push(a),u.more;if(a!==this.prevError){for(a.isError()&&(this.prevError=a),this.pushing=!0,this.pushToSubscriptions(a),this.pushing=!1;this.queue.length;)a=this.queue.shift(),this.push(a);return this.hasSubscribers()?u.more:(this.unsubscribeFromSource(),u.noMore)}},n.prototype.handleEvent=function(a){return this._handleEvent?this._handleEvent(a):this.push(a)},n.prototype.unsubscribeFromSource=function(){this.unsubSrc&&this.unsubSrc(),this.unsubSrc=void 0},n.prototype.subscribe=function(a){var b;return this.ended?(a(ea()),w):(D(a),b={sink:a},this.subscriptions.push(b),1===this.subscriptions.length&&(this.unsubSrc=this._subscribe(this.handleEvent),D(this.unsubSrc)),function(a){return function(){return a.removeSub(b),a.hasSubscribers()?void 0:a.unsubscribeFromSource()}}(this))},u.Dispatcher=n,J(o,l),I(o.prototype,{_isEventStream:!0,toProperty:function(a){var b=0===arguments.length?_:aa(function(){return a}),c=this.dispatcher,d=new u.Desc(this,"toProperty",[a]);return new q(d,function(a){var d=!1,e=!1,g=w,h=u.more,j=function(){return d?void 0:b.forEach(function(b){return d=!0,h=a(new i(b)),h===u.noMore?(g(),g=w,w):void 0})};return g=c.subscribe(function(c){return c.hasValue()?c.isInitial()&&!e?(b=new f(function(){return c.value()}),u.more):(c.isInitial()||j(),d=!0,b=new f(c),a(c)):(c.isEnd()&&(h=j()),h!==u.noMore?a(c):void 0)}),e=!0,j(),g})},toEventStream:function(){return this},withHandler:function(a){return new o(new u.Desc(this,"withHandler",[a]),this.dispatcher.subscribe,a)}}),u.EventStream=o,u.never=function(){return new o(N(u,"never"),function(a){return a(ea()),w})},u.when=function(){if(0===arguments.length)return u.never();var c=arguments.length,d="when: expecting arguments in the form (Observable+,function)+";z(d,c%2===0);for(var e=[],f=[],g=0,h=[];c>g;){h[g]=arguments[g],h[g+1]=arguments[g+1];for(var i,j=K.toArray(arguments[g]),k=ja(arguments[g+1]),l={f:k,ixs:[]},m=!1,n=0;n<j.length;n++){i=j[n];var p=K.indexOf(e,i);m||(m=b.isTrigger(i)),0>p&&(e.push(i),p=e.length-1);for(var q,r=0;r<l.ixs.length;r++)q=l.ixs[r],q.index===p&&q.count++;l.ixs.push({index:p,count:1})}z("At least one EventStream required",m||!j.length),j.length>0&&f.push(l),g+=2}if(!e.length)return u.never();e=K.map(b.fromObservable,e);var s=K.any(e,function(a){return a.flatten})&&ia(K.map(function(a){return a.obs},e)),t=new u.Desc(u,"when",h),v=new o(t,function(b){var c=[],d=!1,g=function(a){for(var b,c=0;c<a.ixs.length;c++)if(b=a.ixs[c],!e[b.index].hasAtLeast(b.count))return!1;return!0},h=function(a){return!a.sync||a.ended},i=function(a){for(var b,c=0;c<a.ixs.length;c++)if(b=a.ixs[c],!e[b.index].mayHave(b.count))return!0},j=function(a){return!a.source.flatten},k=function(k){return function(l){var m=function(){return M.whenDoneWith(v,o)},n=function(){if(!(c.length>0))return u.more;for(var d,h=u.more,i=c.pop(),k=0;k<f.length;k++)if(d=f[k],g(d)){var l=function(){for(var a,b=[],c=0;c<d.ixs.length;c++)a=d.ixs[c],b.push(e[a.index].consume());return b}();return h=b(i.e.apply(function(){var b,c=function(){for(var a,b=[],c=0;c<l.length;c++)a=l[c],b.push(a.value());return b}();return(b=d).f.apply(b,a(c))})),c.length&&(c=K.filter(j,c)),h===u.noMore?h:n()}},o=function(){var a=n();return d&&(K.all(e,h)||K.all(f,i))&&(a=u.noMore,b(ea())),a===u.noMore&&l(),a};return k.subscribe(function(a){if(a.isEnd())d=!0,k.markEnded(),m();else if(a.isError())var e=b(a);else k.push(a),k.sync&&(c.push({source:k,e:a}),s||M.hasWaiters()?m():o());return e===u.noMore&&l(),e||u.more})}};return new u.CompositeUnsubscribe(function(){for(var a,b=[],c=0;c<e.length;c++)a=e[c],b.push(k(a));return b}()).unsubscribe});return v};var ia=function(a){var b=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],c=function(a){if(K.contains(b,a))return!0;var d=a.internalDeps();return d.length?(b.push(a),K.any(d,c)):(b.push(a),!1)};return K.any(a,c)},ja=function(a){return K.isFunction(a)?a:K.always(a)};u.groupSimultaneous=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];1===b.length&&E(b[0])&&(b=b[0]);var e=function(){for(var a,c=[],e=0;e<b.length;e++)a=b[e],c.push(new d(a));return c}();return O(new u.Desc(u,"groupSimultaneous",b),u.when(e,function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return b}))},J(p,n),I(p.prototype,{push:function(a){return a.isEnd()&&(this.propertyEnded=!0),a.hasValue()&&(this.current=new f(a),this.currentValueRootId=M.currentEventId()),n.prototype.push.call(this,a)},maybeSubSource:function(a,b){return b===u.noMore?w:this.propertyEnded?(a(ea()),w):n.prototype.subscribe.call(this,a)},subscribe:function(a){var b=this,c=u.more;if(this.current.isDefined&&(this.hasSubscribers()||this.propertyEnded)){var d=M.currentEventId(),e=this.currentValueRootId;return!this.propertyEnded&&e&&d&&d!==e?(M.whenDoneWith(this.property,function(){return b.currentValueRootId===e?a(ca(b.current.get().value())):void 0}),this.maybeSubSource(a,c)):(M.inTransaction(void 0,this,function(){return c=a(ca(this.current.get().value()))},[]),this.maybeSubSource(a,c))}return this.maybeSubSource(a,c)}}),J(q,l),I(q.prototype,{_isProperty:!0,changes:function(){var a=this;return new o(new u.Desc(this,"changes",[]),function(b){return a.dispatcher.subscribe(function(a){return a.isInitial()?void 0:b(a)})})},withHandler:function(a){return new q(new u.Desc(this,"withHandler",[a]),this.dispatcher.subscribe,a)},toProperty:function(){return H(arguments),this},toEventStream:function(){var a=this;return new o(new u.Desc(this,"toEventStream",[]),function(b){return a.dispatcher.subscribe(function(a){return a.isInitial()&&(a=a.toNext()),b(a)})})}}),u.Property=q,u.constant=function(a){return new q(new u.Desc(u,"constant",[a]),function(b){return b(ca(a)),b(ea()),w})},u.fromBinder=function(a){var b=arguments.length<=1||void 0===arguments[1]?K.id:arguments[1],c=new u.Desc(u,"fromBinder",[a,b]);return new o(c,function(c){var d=!1,e=!1,f=function(){return d?void 0:"undefined"!=typeof g&&null!==g?(g(),d=!0):e=!0},g=a(function(){for(var a,d=arguments.length,e=Array(d),g=0;d>g;g++)e[g]=arguments[g];var h=b.apply(this,e);E(h)&&(null!=(a=K.last(h))?a._isEvent:void 0)||(h=[h]);for(var i,j=u.more,k=0;k<h.length;k++)if(i=h[k],j=c(i=fa(i)),j===u.noMore||i.isEnd())return f(),j;return j});return e&&f(),f})},u.Observable.prototype.map=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return Y(this,a,c,function(a){return O(new u.Desc(this,"map",[a]),this.withHandler(function(b){return this.push(b.fmap(a))}))})};var ka=function(a){return E(a[0])?a[0]:Array.prototype.slice.call(a)},la=function(a){return K.isFunction(a[0])?[ka(Array.prototype.slice.call(a,1)),a[0]]:[ka(Array.prototype.slice.call(a,0,a.length-1)),K.last(a)]};u.combineAsArray=function(){for(var a,c=ka(arguments),d=0;d<c.length;d++)a=c[d],F(a)||(c[d]=u.constant(a));if(c.length){var e=function(){for(var a,d=[],e=0;e<c.length;e++)a=c[e],d.push(new b(a,!0));return d}();return O(new u.Desc(u,"combineAsArray",c),u.when(e,function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return b}).toProperty())}return u.constant([])},u.onValues=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return u.combineAsArray(b.slice(0,b.length-1)).onValues(b[b.length-1])},u.combineWith=function(){var b=la(arguments),c=b[0],d=b[1],e=new u.Desc(u,"combineWith",[d].concat(a(c)));return O(e,u.combineAsArray(c).map(function(b){return d.apply(void 0,a(b))}))},u.Observable.prototype.combine=function(a,b){var c=Z(b),d=new u.Desc(this,"combine",[a,b]);return O(d,u.combineAsArray(this,a).map(function(a){return c(a[0],a[1])}))},u.Observable.prototype.withStateMachine=function(a,b){var c=a,d=new u.Desc(this,"withStateMachine",[a,b]);return O(d,this.withHandler(function(a){var d=b(c,a),e=d[0],f=d[1];c=e;for(var g,h=u.more,i=0;i<f.length;i++)if(g=f[i],h=this.push(g),h===u.noMore)return h;return h}))};var ma=function(a,b){return a===b},na=function(a){return"undefined"!=typeof a&&null!==a?a._isNone:!1};u.Observable.prototype.skipDuplicates=function(){var a=arguments.length<=0||void 0===arguments[0]?ma:arguments[0],b=new u.Desc(this,"skipDuplicates",[]);return O(b,this.withStateMachine(_,function(b,c){return c.hasValue()?c.isInitial()||na(b)||!a(b.get(),c.value())?[new f(c.value()),[c]]:[b,[]]:[b,[c]]}))},u.Observable.prototype.awaiting=function(a){var b=new u.Desc(this,"awaiting",[a]);return O(b,u.groupSimultaneous(this,a).map(function(a){return 0===a[1].length}).toProperty(!1).skipDuplicates())},u.Observable.prototype.not=function(){return O(new u.Desc(this,"not",[]),this.map(function(a){return!a}))},u.Property.prototype.and=function(a){return O(new u.Desc(this,"and",[a]),this.combine(a,function(a,b){return a&&b}))},u.Property.prototype.or=function(a){return O(new u.Desc(this,"or",[a]),this.combine(a,function(a,b){return a||b}))},u.scheduler={setTimeout:function(a,b){return setTimeout(a,b)},setInterval:function(a,b){return setInterval(a,b)},clearInterval:function(a){return clearInterval(a)},clearTimeout:function(a){return clearTimeout(a)},now:function(){return(new Date).getTime()}},u.EventStream.prototype.bufferWithTime=function(a){return O(new u.Desc(this,"bufferWithTime",[a]),this.bufferWithTimeOrCount(a,Number.MAX_VALUE))},u.EventStream.prototype.bufferWithCount=function(a){return O(new u.Desc(this,"bufferWithCount",[a]),this.bufferWithTimeOrCount(void 0,a))},u.EventStream.prototype.bufferWithTimeOrCount=function(a,b){var c=function(c){return c.values.length===b?c.flush():void 0!==a?c.schedule():void 0},d=new u.Desc(this,"bufferWithTimeOrCount",[a,b]);return O(d,this.buffer(a,c,c))},u.EventStream.prototype.buffer=function(a){var b=arguments.length<=1||void 0===arguments[1]?w:arguments[1],c=arguments.length<=2||void 0===arguments[2]?w:arguments[2],d={scheduled:null,end:void 0,values:[],flush:function(){if(this.scheduled&&(u.scheduler.clearTimeout(this.scheduled),this.scheduled=null),this.values.length>0){var a=this.values;this.values=[];var b=this.push(da(a));if(null!=this.end)return this.push(this.end);if(b!==u.noMore)return c(this)}else if(null!=this.end)return this.push(this.end)},schedule:function(){var b=this;return this.scheduled?void 0:this.scheduled=a(function(){return b.flush()})}},e=u.more;if(!K.isFunction(a)){var f=a;a=function(a){return u.scheduler.setTimeout(a,f)}}return O(new u.Desc(this,"buffer",[]),this.withHandler(function(a){var c=this;return d.push=function(a){return c.push(a)},a.isError()?e=this.push(a):a.isEnd()?(d.end=a,d.scheduled||d.flush()):(d.values.push(a.value()),b(d)),e}))},u.Observable.prototype.filter=function(a){A(a);for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return Y(this,a,c,function(a){return O(new u.Desc(this,"filter",[a]),this.withHandler(function(b){return b.filter(a)?this.push(b):u.more}))})},u.once=function(a){return new o(new e(u,"once",[a]),function(b){return b(fa(a)),b(ea()),w})},u.EventStream.prototype.concat=function(a){var b=this;return new o(new u.Desc(b,"concat",[a]),function(c){var d=w,e=b.dispatcher.subscribe(function(b){return b.isEnd()?d=a.dispatcher.subscribe(c):c(b)});return function(){return e(),d()}})},u.Observable.prototype.flatMap=function(){return qa(this,oa(arguments))},u.Observable.prototype.flatMapFirst=function(){return qa(this,oa(arguments),!0)};var oa=function(a){return 1===a.length&&F(a[0])?K.always(a[0]):R(a)},pa=function(a){return F(a)?a:u.once(a)},qa=function(a,b,c,d){var e=[a],f=[],g=new u.Desc(a,"flatMap"+(c?"First":""),[b]),h=new o(g,function(e){var g=new m,h=[],i=function(a){var c=pa(b(a.value()));return f.push(c),g.add(function(a,b){return c.dispatcher.subscribe(function(d){if(d.isEnd())return K.remove(c,f),j(),k(b),u.noMore;("undefined"!=typeof d&&null!==d?d._isInitial:void 0)&&(d=d.toNext());var g=e(d);return g===u.noMore&&a(),g})})},j=function(){var a=h.shift();return a?i(a):void 0},k=function(a){return a(),g.empty()?e(ea()):void 0};return g.add(function(b,f){return a.dispatcher.subscribe(function(a){return a.isEnd()?k(f):a.isError()?e(a):c&&g.count()>1?u.more:g.unsubscribed?u.noMore:d&&g.count()>d?h.push(a):i(a)})}),g.unsubscribe});return h.internalDeps=function(){return f.length?e.concat(f):e},h};u.Observable.prototype.flatMapWithConcurrencyLimit=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];var e=new u.Desc(this,"flatMapWithConcurrencyLimit",[a].concat(c));return O(e,qa(this,oa(c),!1,a))},u.Observable.prototype.flatMapConcat=function(){var a=new u.Desc(this,"flatMapConcat",Array.prototype.slice.call(arguments,0));return O(a,this.flatMapWithConcurrencyLimit.apply(this,[1].concat(t.call(arguments))))},u.later=function(a,b){return O(new u.Desc(u,"later",[a,b]),u.fromBinder(function(c){var d=function(){return c([b,ea()])},e=u.scheduler.setTimeout(d,a);return function(){return u.scheduler.clearTimeout(e)}}))},u.Observable.prototype.bufferingThrottle=function(a){var b=new u.Desc(this,"bufferingThrottle",[a]);return O(b,this.flatMapConcat(function(b){return u.once(b).concat(u.later(a).filter(!1))}))},u.Property.prototype.bufferingThrottle=function(){return u.Observable.prototype.bufferingThrottle.apply(this,arguments).toProperty()},J(r,o),I(r.prototype,{unsubAll:function(){for(var a,b=this.subscriptions,c=0;c<b.length;c++)a=b[c],"function"==typeof a.unsub&&a.unsub()},subscribeAll:function(a){if(this.ended)a(ea());else{this.sink=a;for(var b,c=y(this.subscriptions),d=0;d<c.length;d++)b=c[d],this.subscribeInput(b)}return this.unsubAll},guardedSink:function(a){var b=this;return function(c){return c.isEnd()?(b.unsubscribeInput(a),u.noMore):b.sink(c)}},subscribeInput:function(a){return a.unsub=a.input.dispatcher.subscribe(this.guardedSink(a.input)),a.unsub},unsubscribeInput:function(a){for(var b,c=this.subscriptions,d=0;d<c.length;d++)if(b=c[d],b.input===a)return"function"==typeof b.unsub&&b.unsub(),void this.subscriptions.splice(d,1)},plug:function(a){var b=this;if(C(a),!this.ended){var c={input:a};return this.subscriptions.push(c),"undefined"!=typeof this.sink&&this.subscribeInput(c),function(){return b.unsubscribeInput(a)}}},end:function(){return this.ended=!0,this.unsubAll(),"function"==typeof this.sink?this.sink(ea()):void 0},push:function(a){return this.ended||"function"!=typeof this.sink?void 0:this.sink(da(a))},error:function(a){return"function"==typeof this.sink?this.sink(new k(a)):void 0}}),u.Bus=r;var ra=function(b,c){return Q(function(d){for(var e=S(c,[function(b,c){return d.apply(void 0,a(b).concat([c]))}]),f=arguments.length,g=Array(f>1?f-1:0),h=1;f>h;h++)g[h-1]=arguments[h];return O(new u.Desc(u,b,[d].concat(g)),u.combineAsArray(g).flatMap(e))})};u.fromCallback=ra("fromCallback",function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return u.fromBinder(function(b){return X(a,c)(b),w},function(a){return[a,ea()]})}),u.fromNodeCallback=ra("fromNodeCallback",function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return u.fromBinder(function(b){return X(a,c)(b),w},function(a,b){return a?[new k(a),ea()]:[b,ea()]})}),u.combineTemplate=function(a){function b(a){return a[a.length-1]}function c(a,c,d){return b(a)[c]=d,d}function d(a,b){return function(d,e){return c(d,a,e[b])}}function e(a,b){return function(d){return c(d,a,b)}}function f(a){return E(a)?[]:{}}function g(a,b){return function(d){var e=f(b);return c(d,a,e),d.push(e)}}function h(a,b){if(F(b))return l.push(b),k.push(d(a,l.length-1));if(!b||b.constructor!=Object&&b.constructor!=Array)return k.push(e(a,b));var c=function(a){return a.pop()};return k.push(g(a,b)),j(b),k.push(c)}function i(b){for(var c,d=f(a),e=[d],g=0;g<k.length;g++)(c=k[g])(e,b);return d}function j(a){return K.each(a,h)}var k=[],l=[];return j(a),O(new u.Desc(u,"combineTemplate",[a]),u.combineAsArray(l).map(i))};var sa=function(a,b){var c=new o(N(a,"justInitValue"),function(b){var d=void 0,e=a.dispatcher.subscribe(function(a){return a.isEnd()||(d=a),u.noMore});return M.whenDoneWith(c,function(){return"undefined"!=typeof d&&null!==d&&b(d),b(ea())}),e});return c.concat(b).toProperty()};u.Observable.prototype.mapEnd=function(){var a=R(arguments);return O(new u.Desc(this,"mapEnd",[a]),this.withHandler(function(b){return b.isEnd()?(this.push(da(a(b))),this.push(ea()),u.noMore):this.push(b)}))},u.Observable.prototype.skipErrors=function(){return O(new u.Desc(this,"skipErrors",[]),this.withHandler(function(a){return a.isError()?u.more:this.push(a)}))},u.EventStream.prototype.takeUntil=function(a){var b={};return O(new u.Desc(this,"takeUntil",[a]),u.groupSimultaneous(this.mapEnd(b),a.skipErrors()).withHandler(function(a){if(a.hasValue()){var c=a.value(),d=c[0],e=c[1];if(e.length)return this.push(ea());for(var f,g=u.more,h=0;h<d.length;h++)f=d[h],g=f===b?this.push(ea()):this.push(da(f));return g}return this.push(a)}))},u.Property.prototype.takeUntil=function(a){var b=this.changes().takeUntil(a);return O(new u.Desc(this,"takeUntil",[a]),sa(this,b))},u.Observable.prototype.flatMapLatest=function(){var a=oa(arguments),b=this.toEventStream();return O(new u.Desc(this,"flatMapLatest",[a]),b.flatMap(function(c){return pa(a(c)).takeUntil(b)}))},u.Property.prototype.delayChanges=function(a,b){return O(a,sa(this,b(this.changes())))},u.EventStream.prototype.delay=function(a){
return O(new u.Desc(this,"delay",[a]),this.flatMap(function(b){return u.later(a,b)}))},u.Property.prototype.delay=function(a){return this.delayChanges(new u.Desc(this,"delay",[a]),function(b){return b.delay(a)})},u.EventStream.prototype.debounce=function(a){return O(new u.Desc(this,"debounce",[a]),this.flatMapLatest(function(b){return u.later(a,b)}))},u.Property.prototype.debounce=function(a){return this.delayChanges(new u.Desc(this,"debounce",[a]),function(b){return b.debounce(a)})},u.EventStream.prototype.debounceImmediate=function(a){return O(new u.Desc(this,"debounceImmediate",[a]),this.flatMapFirst(function(b){return u.once(b).concat(u.later(a).filter(!1))}))},u.Observable.prototype.decode=function(a){return O(new u.Desc(this,"decode",[a]),this.combine(u.combineTemplate(a),function(a,b){return b[a]}))},u.Observable.prototype.scan=function(a,b){var c,d=this;b=Z(b);var e=aa(a),g=!1,h=function(a){var h=!1,j=w,k=u.more,l=function(){return h?void 0:e.forEach(function(b){return h=g=!0,k=a(new i(function(){return b})),k===u.noMore?(j(),j=w):void 0})};return j=d.dispatcher.subscribe(function(c){if(c.hasValue()){if(g&&c.isInitial())return u.more;c.isInitial()||l(),h=g=!0;var d=e.getOrElse(void 0),i=b(d,c.value());return e=new f(i),a(c.apply(function(){return i}))}return c.isEnd()&&(k=l()),k!==u.noMore?a(c):void 0}),M.whenDoneWith(c,l),j};return c=new q(new u.Desc(this,"scan",[a,b]),h)},u.Observable.prototype.diff=function(a,b){return b=Z(b),O(new u.Desc(this,"diff",[a,b]),this.scan([a],function(a,c){return[c,b(a[0],c)]}).filter(function(a){return 2===a.length}).map(function(a){return a[1]}))},u.Observable.prototype.doAction=function(){var a=R(arguments);return O(new u.Desc(this,"doAction",[a]),this.withHandler(function(b){return b.hasValue()&&a(b.value()),this.push(b)}))},u.Observable.prototype.doEnd=function(){var a=R(arguments);return O(new u.Desc(this,"doEnd",[a]),this.withHandler(function(b){return b.isEnd()&&a(),this.push(b)}))},u.Observable.prototype.doError=function(){var a=R(arguments);return O(new u.Desc(this,"doError",[a]),this.withHandler(function(b){return b.isError()&&a(b.error),this.push(b)}))},u.Observable.prototype.doLog=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return O(new u.Desc(this,"doLog",b),this.withHandler(function(a){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log.apply(console,b.concat([a.log()])),this.push(a)}))},u.Observable.prototype.endOnError=function(a){("undefined"==typeof a||null===a)&&(a=!0);for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return Y(this,a,c,function(a){return O(new u.Desc(this,"endOnError",[]),this.withHandler(function(b){return b.isError()&&a(b.error)?(this.push(b),this.push(ea())):this.push(b)}))})},l.prototype.errors=function(){return O(new u.Desc(this,"errors",[]),this.filter(function(){return!1}))},u.Observable.prototype.take=function(a){return 0>=a?u.never():O(new u.Desc(this,"take",[a]),this.withHandler(function(b){return b.hasValue()?(a--,a>0?this.push(b):(0===a&&this.push(b),this.push(ea()),u.noMore)):this.push(b)}))},u.Observable.prototype.first=function(){return O(new u.Desc(this,"first",[]),this.take(1))},u.Observable.prototype.mapError=function(){var a=R(arguments);return O(new u.Desc(this,"mapError",[a]),this.withHandler(function(b){return b.isError()?this.push(da(a(b.error))):this.push(b)}))},u.Observable.prototype.flatMapError=function(a){var b=new u.Desc(this,"flatMapError",[a]);return O(b,this.mapError(function(a){return new k(a)}).flatMap(function(b){return b instanceof k?a(b.error):u.once(b)}))},u.EventStream.prototype.sampledBy=function(a,b){return O(new u.Desc(this,"sampledBy",[a,b]),this.toProperty().sampledBy(a,b))},u.Property.prototype.sampledBy=function(a,c){var d=!1;"undefined"!=typeof c&&null!==c?c=Z(c):(d=!0,c=function(a){return a.value()});var e=new b(this,!1,d),f=new b(a,!0,d),g=u.when([e,f],c),h=a._isProperty?g.toProperty():g;return O(new u.Desc(this,"sampledBy",[a,c]),h)},u.Property.prototype.sample=function(a){return O(new u.Desc(this,"sample",[a]),this.sampledBy(u.interval(a,{})))},u.Observable.prototype.map=function(a){if(a&&a._isProperty)return a.sampledBy(this,x);for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return Y(this,a,c,function(a){return O(new u.Desc(this,"map",[a]),this.withHandler(function(b){return this.push(b.fmap(a))}))})},u.Observable.prototype.fold=function(a,b){return O(new u.Desc(this,"fold",[a,b]),this.scan(a,b).sampledBy(this.filter(!1).mapEnd().toProperty()))},l.prototype.reduce=l.prototype.fold;var ta=[["addEventListener","removeEventListener"],["addListener","removeListener"],["on","off"],["bind","unbind"]],ua=function(a){for(var b,c=0;c<ta.length;c++){b=ta[c];var d=[a[b[0]],a[b[1]]];if(d[0]&&d[1])return d}for(var e=0;e<ta.length;e++){b=ta[e];var f=a[b[0]];if(f)return[f,function(){}]}throw new k("No suitable event methods in "+a)};u.fromEventTarget=function(a,b,c){var d=ua(a),e=d[0],f=d[1],g=new u.Desc(u,"fromEvent",[a,b]);return O(g,u.fromBinder(function(c){return e.call(a,b,c),function(){return f.call(a,b,c)}},c))},u.fromEvent=u.fromEventTarget,u.fromPoll=function(a,b){var c=new u.Desc(u,"fromPoll",[a,b]);return O(c,u.fromBinder(function(b){var c=u.scheduler.setInterval(b,a);return function(){return u.scheduler.clearInterval(c)}},b))},u.fromPromise=function(a,b){var c=arguments.length<=2||void 0===arguments[2]?s:arguments[2];return O(new u.Desc(u,"fromPromise",[a]),u.fromBinder(function(c){var d=a.then(c,function(a){return c(new k(a))});return d&&"function"==typeof d.done&&d.done(),b?function(){return"function"==typeof a.abort?a.abort():void 0}:function(){}},c))},u.Observable.prototype.groupBy=function(a){var b=arguments.length<=1||void 0===arguments[1]?u._.id:arguments[1],c={},d=this;return d.filter(function(b){return!c[a(b)]}).map(function(e){var f=a(e),g=d.filter(function(b){return a(b)===f}),h=u.once(e).concat(g),i=b(h,e).withHandler(function(a){return this.push(a),a.isEnd()?delete c[f]:void 0});return c[f]=i,i})},u.fromArray=function(a){if(G(a),a.length){var b=0;return new o(new u.Desc(u,"fromArray",[a]),function(c){var d=!1,e=u.more,f=!1,g=!1,h=function(){if(g=!0,!f){for(f=!0;g;)if(g=!1,e!==u.noMore&&!d){var i=a[b++];e=c(fa(i)),e!==u.noMore&&(b===a.length?c(ea()):M.afterTransaction(h))}return f=!1}};return h(),function(){return d=!0}})}return O(new u.Desc(u,"fromArray",a),u.never())},u.EventStream.prototype.holdWhen=function(a){var b=!1,c=[],d=this;return new o(new u.Desc(this,"holdWhen",[a]),function(e){var f=new m,g=!1,h=function(a){return"function"==typeof a&&a(),f.empty()&&g?e(ea()):void 0};return f.add(function(d,f){return a.subscribeInternal(function(a){if(!a.hasValue())return a.isEnd()?h(f):e(a);if(b=a.value(),!b){var d=c;return c=[],function(){for(var a,b=[],c=0;c<d.length;c++)a=d[c],b.push(e(da(a)));return b}()}})}),f.add(function(a,f){return d.subscribeInternal(function(a){return b&&a.hasValue()?c.push(a.value()):a.isEnd()&&c.length?h(f):e(a)})}),g=!0,h(),f.unsubscribe})},u.interval=function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return O(new u.Desc(u,"interval",[a,b]),u.fromPoll(a,function(){return da(b)}))},u.$={},u.$.asEventStream=function(a,b,c){var d=this;return K.isFunction(b)&&(c=b,b=void 0),O(new u.Desc(this.selector||this,"asEventStream",[a]),u.fromBinder(function(c){return d.on(a,b,c),function(){return d.off(a,b,c)}},c))},"undefined"!=typeof jQuery&&jQuery&&(jQuery.fn.asEventStream=u.$.asEventStream),"undefined"!=typeof Zepto&&Zepto&&(Zepto.fn.asEventStream=u.$.asEventStream),u.Observable.prototype.last=function(){var a;return O(new u.Desc(this,"last",[]),this.withHandler(function(b){return b.isEnd()?(a&&this.push(a),this.push(ea()),u.noMore):void(a=b)}))},u.Observable.prototype.log=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return this.subscribe(function(a){"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,b.concat([a.log()]))}),this},u.EventStream.prototype.merge=function(a){B(a);var b=this;return O(new u.Desc(b,"merge",[a]),u.mergeAll(this,a))},u.mergeAll=function(){var a=ka(arguments);return a.length?new o(new u.Desc(u,"mergeAll",a),function(b){var c=0,d=function(d){return function(e){return d.dispatcher.subscribe(function(d){if(d.isEnd())return c++,c===a.length?b(ea()):u.more;var f=b(d);return f===u.noMore&&e(),f})}},e=K.map(d,a);return new u.CompositeUnsubscribe(e).unsubscribe}):u.never()},u.repeatedly=function(a,b){var c=0;return O(new u.Desc(u,"repeatedly",[a,b]),u.fromPoll(a,function(){return b[c++%b.length]}))},u.repeat=function(a){var b=0;return u.fromBinder(function(c){function d(a){return a.isEnd()?f?e():f=!0:g=c(a)}function e(){var e;for(f=!0;f&&g!==u.noMore;)e=a(b++),f=!1,e?h=e.subscribeInternal(d):c(ea());return f=!0}var f=!1,g=u.more,h=function(){};return e(),function(){return h()}})},u.retry=function(a){if(!K.isFunction(a.source))throw new v("'source' option has to be a function");var b=a.source,c=a.retries||0,d=a.maxRetries||c,e=a.delay||function(){return 0},f=a.isRetryable||function(){return!0},g=!1,h=null;return O(new u.Desc(u,"retry",[a]),u.repeat(function(){function a(){return b().endOnError().withHandler(function(a){return a.isError()?(h=a,f(h.error)&&c>0?void 0:(g=!0,this.push(a))):(a.hasValue()&&(h=null,g=!0),this.push(a))})}if(g)return null;if(h){var i={error:h.error,retriesDone:d-c},j=u.later(e(i)).filter(!1);return c-=1,j.concat(u.once().flatMap(a))}return a()}))},u.sequentially=function(a,b){var c=0;return O(new u.Desc(u,"sequentially",[a,b]),u.fromPoll(a,function(){var a=b[c++];return c<b.length?a:c===b.length?[a,ea()]:ea()}))},u.Observable.prototype.skip=function(a){return O(new u.Desc(this,"skip",[a]),this.withHandler(function(b){return b.hasValue()&&a>0?(a--,u.more):this.push(b)}))},u.EventStream.prototype.skipUntil=function(a){var b=a.take(1).map(!0).toProperty(!1);return O(new u.Desc(this,"skipUntil",[a]),this.filter(b))},u.EventStream.prototype.skipWhile=function(a){A(a);for(var b=!1,c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];return Y(this,a,d,function(a){return O(new u.Desc(this,"skipWhile",[a]),this.withHandler(function(c){return!b&&c.hasValue()&&a(c.value())?u.more:(c.hasValue()&&(b=!0),this.push(c))}))})},u.Observable.prototype.slidingWindow=function(a){var b=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return O(new u.Desc(this,"slidingWindow",[a,b]),this.scan([],function(b,c){return b.concat([c]).slice(-a)}).filter(function(a){return a.length>=b}))};var va=[],ha=function(a){if(va.length&&!ha.running)try{ha.running=!0,va.forEach(function(b){b(a)})}finally{delete ha.running}};u.spy=function(a){return va.push(a)},u.Property.prototype.startWith=function(a){return O(new u.Desc(this,"startWith",[a]),this.scan(a,function(a,b){return b}))},u.EventStream.prototype.startWith=function(a){return O(new u.Desc(this,"startWith",[a]),u.once(a).concat(this))},u.Observable.prototype.takeWhile=function(a){A(a);for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return Y(this,a,c,function(a){return O(new u.Desc(this,"takeWhile",[a]),this.withHandler(function(b){return b.filter(a)?this.push(b):(this.push(ea()),u.noMore)}))})},u.EventStream.prototype.throttle=function(a){return O(new u.Desc(this,"throttle",[a]),this.bufferWithTime(a).map(function(a){return a[a.length-1]}))},u.Property.prototype.throttle=function(a){return this.delayChanges(new u.Desc(this,"throttle",[a]),function(b){return b.throttle(a)})},l.prototype.firstToPromise=function(a){var b=this;if("function"!=typeof a){if("function"!=typeof Promise)throw new v("There isn't default Promise, use shim or parameter");a=Promise}return new a(function(a,c){return b.subscribe(function(b){return b.hasValue()&&a(b.value()),b.isError()&&c(b.error),u.noMore})})},l.prototype.toPromise=function(a){return this.last().firstToPromise(a)},u["try"]=function(a){return function(b){try{return u.once(a(b))}catch(c){return new u.Error(c)}}},u.update=function(b){function c(b){return function(){for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];return function(c){return b.apply(void 0,a([c].concat(d)))}}}for(var d=arguments.length,e=Array(d>1?d-1:0),f=1;d>f;f++)e[f-1]=arguments[f];for(var g=e.length-1;g>0;)e[g]instanceof Function||(e[g]=K.always(e[g])),e[g]=c(e[g]),g-=2;return O(new u.Desc(u,"update",[b].concat(e)),u.when.apply(u,e).scan(b,function(a,b){return b(a)}))},u.zipAsArray=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];var d=ka(b);return O(new u.Desc(u,"zipAsArray",d),u.zipWith(d,function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return b}))},u.zipWith=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];var d=la(b),e=d[0],f=d[1];return e=K.map(function(a){return a.toEventStream()},e),O(new u.Desc(u,"zipWith",[f].concat(e)),u.when(e,f))},u.Observable.prototype.zip=function(a,b){return O(new u.Desc(this,"zip",[a]),u.zipWith([this,a],b||Array))},"undefined"!=typeof define&&null!==define&&null!=define.amd?(define([],function(){return u}),"undefined"!=typeof this&&null!==this&&(this.Bacon=u)):"undefined"!=typeof module&&null!==module&&null!=module.exports?(module.exports=u,u.Bacon=u):this.Bacon=u}).call(this),function(a,b){function c(a,b){return a.hasOwnProperty(b)||(a[b]=o[b]),a}function d(b){a.onYouTubeIframeAPIReady&&console.log("This page already uses the YouTube Iframe API. Set the option trackVideo to false to avoid clashes."),a.onYouTubeIframeAPIReady=i,"undefined"==typeof jQuery&&console.log("jQuery is required to run Attention Analytics"),v="undefined"!=typeof b?b:{};for(var d in o)v=c(v,d);v.trackVideo===!0&&h(),m()}function e(a){v.debug&&console.log(a)}function f(a,b,c,d,f){e("Sending event '"+b+"' with label '"+c+"'"),"undefined"!=typeof dataLayer?dataLayer.push({event:"attentionEvent",event_details:{category:a,action:b,label:c,value:d,ni:f}}):console.log("No dataLayer object found on page. Is Google Tag Manager implemented?")}function g(){var a=Math.floor(p/60),b=String(a)+" - "+String(a+1)+" mins";e("Sending attention ping..."),"undefined"!=typeof dataLayer?(e("Attention ping at "+p),dataLayer.push({event:"engagementPing",ping:{value:v.pingFreq,band:b,total:p}})):e("No dataLayer object found on page. Is Google Tag Manager implemented on this page?")}function h(){var a=document.createElement("script");a.src="https://www.youtube.com/iframe_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b);for(var c=document.getElementsByTagName("iframe"),d=c.length;d--;)/youtube.com\/embed/.test(c[d].src)&&-1===c[d].src.indexOf("enablejsapi=")&&(c[d].src+=(-1===c[d].src.indexOf("?")?"?":"&")+"enablejsapi=1")}function i(){for(var a=document.getElementsByTagName("iframe"),b=a.length;b--;)/youtube.com\/embed/.test(a[b].src)&&j(a[b])}function j(a){var c=b.fromBinder(function(b){s.push(new YT.Player(a,{events:{onStateChange:function(a){var c={state:"stopped",title:a.target.getVideoData().title};a.data===YT.PlayerState.PLAYING?c.state="playing":a.data===YT.PlayerState.PAUSED?c.state="paused":a.data===YT.PlayerState.ENDED&&(c.state="stopped"),b(c)}}}))});"undefined"==typeof _videoEventStreams?_videoEventStreams=c:_videoEventStreams=_videoEventStreams.merge(c),_videoEventStreams.onValue(function(a){"playing"===a.state?f("Video","Played Video",a.title,0,!1):"paused"===a.state?f("Video","Paused Video",a.title,0,!1):"ended"===a.state&&f("Video","Video Ended",a.title,0,!1)}),t=_videoEventStreams.flatMapLatest(function(a){var c="playing"==a.state?!0:!1;return b.once(c)}).toProperty(!1),m()}function k(a){if(a!==q)if(q=a,q===!0){void 0!==typeof r&&clearInterval(r);var b=n/1e3;e("Active. Timer at "+p+" seconds"),r=setInterval(function(){p+=b,p%v.pingFreq==0&&g()},n)}else e("Inactive. Timer at "+p+" seconds"),void 0!==typeof r&&clearInterval(r)}function l(){return b.once(!0).merge(b.once(!1).delay(1e3*v.gracePeriod))}function m(){var c=jQuery(a).asEventStream("focus"),d=jQuery(a).asEventStream("blur"),e=c.map(!0).merge(d.map(!1)).toProperty(!0),f=b.mergeAll(jQuery(a).asEventStream("focus"),jQuery(a).asEventStream("click"),jQuery(a).asEventStream("scroll"),jQuery(a).asEventStream("mousemove"),jQuery(a).asEventStream("touchstart"),jQuery(a).asEventStream("touchend"),jQuery(a).asEventStream("touchcancel"),jQuery(a).asEventStream("touchleave"),jQuery(a).asEventStream("touchmove")),g=f.flatMapLatest(l).toProperty(!0),h=g.and(e).or(t);h.onValue(k)}var n=1e3,o={pageContentSlot:1,engagedSecondsSlot:1,pingFreq:5,gracePeriod:5,trackVideo:!0,debug:!1},p=0,q=!1,r=null,s=[],t=b.once(!1).toProperty(!1),u=b.once(!1).toProperty(!1),v={};a._mme.videoStarted=function(a){u=b.once(!0).toProperty(!0)},a._mme.videoStopped=function(a){u=b.once(!1).toProperty(!1)},d(a._mme)}(window,Bacon);